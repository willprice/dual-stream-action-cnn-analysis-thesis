sudo: yes
language: generic
dist: trusty
cache:
  - $HOME/.cabal/packages
  - $HOME/.cabal/store
  - $HOME/.cabal/bin

# We remove the index because it churns quite a bit and we don't want
# to pay the cost of repeatedly caching it even though we don't care
# about most changing packages.
before_cache:
 - rm -fv $HOME/.cabal/packages/hackage.haskell.org/build-reports.log
 - rm -fv $HOME/.cabal/packages/hackage.haskell.org/00-index*
 - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index*
 - rm -fv $HOME/.cabal/packages/hackage.haskell.org/*.json

before_install:
# Download and unpack the stack executable
 - mkdir -p ~/.local/bin
 - export PATH=$HOME/.local/bin:$PATH
 - travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'

install:
  - sudo apt-get update -q
  - sudo apt-get install -y texlive-full
  - sudo apt-get install -y gpp inkscape
  - sudo apt-get install -y asciidoc
  - stack install pandoc
  - stack install pandoc-citeproc
  - stack install pandoc-crossref
  - |
    pushd .
    echo $PATH
    git clone https://gitlab.com/git-latexdiff/git-latexdiff.git
    cd git-latexdiff
    sudo make install
    popd
  - |

script:
  - |
    mkdir build
    make
